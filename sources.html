<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no"><title  id="page-title">STaTbS21D - Book of the Dead Sources</title><meta name="description" content="Synoptic Edition of Book of the Dead Spell Sources from the 21st Dynasty (STaTbS21D) is a Digital Humanities project on Egyptology, provides edited and digitalized Book of the Dead spell sources from the end of the New Kingdom and the beginning of the Third Intermediate Period (particularly the 21st Dynasty) for the Egyptological community and the general public."><link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700,700i,600,600i&amp;display=swap"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.css">
<link  id="page-css" rel="stylesheet" href="assets/css/styles.min.css"><script src="assets/js/jquery-3.6.3.js?h=84e399b8f2181ccd73394fdeddff1638"></script>
<script src="assets/js/crypto-js.min.js"></script>
</head>

<body>

<nav id="nav-bar" class="navbar navbar-light navbar-expand-lg sticky-top bg-white clean-navbar" style="position: relative;overflow: visible;display: inline;">
</nav>

<main class="page sources">

<section class="clean-block clean-testimonials dark">
<div class="container">
	<div class="block-heading">
		<h2 class="text-info">Book of the Dead Sources</h2>
	</div>

	<div class="row">
		<div id="fileListBody" class="block-content">
			   <!-- Content will be dynamically generated here --><table><div align="center"><img src="assets/img/loading.gif" /></div></table>
		</div>	
	</div>
</div>
</section>

</main>

<script>
 $(document).ready(function () {
    
			var owner = 'STaTBS21D';
			var repo = 'Book_of_the_Dead_Sources';
			var token = 'U2FsdGVkX1/o/4PlzavsXrZ3oQmKr/WA8zHuMWQwZfxTPcwWjWOrWLSxxFQ9REd10KY3i3R8T0rvI8NY1oMIbBvTmnngNWxH8hrHYlEe4VLQgssCbY5Af+DxFkwB7MkIXswSZItuoayQeKIvcKATGg=='; 
			var password = 'senerpaitui';
			var decryptedBytes = CryptoJS.AES.decrypt(token, password);
			token = decryptedBytes.toString(CryptoJS.enc.Utf8);
			
			
			 
			var apiEndpoint = 'https://api.github.com/repos/' + owner + '/' + repo + '/git/trees/main?recursive=1';
			
			var headers = {
                    'Authorization': 'Bearer ' + token,
					 'X-GitHub-Api-Version': '2022-11-28'
                };

			
			$.ajax({
			  url: apiEndpoint,
			  //dataType: 'json',
			  headers: headers,
			  success: function(response) {
				
						var folderList = {};
						var rootSpell = {};
						var ind = '';
				
						$.each(response.tree, function(index, item) {
                            if (item.type === 'blob') {
                                var path = item.path; 
								
                                if (path.includes('Unicode/')) {
                                    var rootFolder = getRootFolder(path); 
										ind = rootFolder;

                                    if (rootFolder) { 
									
										  var fileSeparator = rootFolder.indexOf(' - ');
										  var TMnumber = rootFolder.substr(0, fileSeparator);
										  TMnumber = TMnumber.substring(3);
										  var papyrus = rootFolder.substr(fileSeparator + 2);
										  papyrus = papyrus.slice(0, -3);
										  var spell = getSpellFolder(path).substring(6);
									
                                        if (!folderList[TMnumber]) {
										
                                            folderList[TMnumber] = []; 
											rootSpell[TMnumber] = [];
                                        }

										folderList[TMnumber].push(papyrus); 
										rootSpell[TMnumber].push(spell); 
                                    }
                                }
                            }
                        });
												
						var file_folder = [];
						
						// Iterate through both arrays
						$.each(folderList, function(i, fileName) {
							  var folder = rootSpell[i];

							  // Check if the file name already exists in the third array
							  var existingFile = file_folder.find(function(item) {
								return item[0] === fileName;
							  });

							  if (existingFile) {
								// If it does, add the corresponding spell folder to the nested array for that file
								existingFile.push(folder);
							  } else {
								// If it doesn't, create a new nested array for that file and add the corresponding spell folder
								file_folder.push([i + ' - ' + fileName, folder]);
							  }
							});
						
						
						// Iterate through the third array to print it in a tabular fashion with jquery
						var table = $('<table>');
						var headerRow = $('<tr>').append($('<th>').text('Book of the Dead Spell Source')).append($('<th>').text('Available Spells'));
						table.append(headerRow);
						
						
						for (var i = 0; i < file_folder.length; i++) {
						  var file = file_folder[i][0]; 
						  var folders = file_folder[i].slice(1); 
						  
						  var fileSeparator = file.indexOf(' - ');
						  var TMnumber = file.substr(0, fileSeparator);
						  var papyrus = file.substr(fileSeparator + 2);
						  var spell = folders[0]; //  REVISAR AQUÍ!!!!!!!!!!						  
						 						  
						  var row = $('<tr>').append($('<td>').html(papyrus + ' <a href="https://totenbuch.awk.nrw.de/objekt/tm' + TMnumber + '" target="_blank"><sup alt="Totenbuch Projekt reference">[TbP]</sup></a> <a href="https://trismegistos.org/text/' + TMnumber + '" target="_blank"><sup alt="Trismegistos reference">[TM]</sup></a>')).append($('<td>').html('<a class="btn btn-light" href="spells.html#sp' + spell + '">Spell ' + spell + '</a>'));
						  
						  table.append(row);
						}
			  
						$('#fileListBody').html(table);
										
			  },
			  error: function() {
				$('#fileListBody').html('Error fetching files from GitHub repository.');
			  }
			 			  
			});


						function getRootFolder(filePath) {
							var segments = filePath.split('/');
							var index = segments.indexOf('Unicode');

							if (index !== -1 && segments.length > index + 1) {
								return segments[index + 1];
							}

							return null;
						}
						
						function getSpellFolder(filePath) {
							var segments = filePath.split('/');
							var index = segments.indexOf('Unicode');

							if (index !== -1 && segments.length > index + 1) {
								return segments[index - 1];
							}

							return null;
						}
						
						function getFileNameWithoutExtension(filePath) {
							var fileName = filePath.split('/').pop();
							return fileName.substring(0, fileName.lastIndexOf('.'));
						}
								
});
</script>
	
<footer id="footer" class="page-footer dark"></footer>

<script>
$(document).ready(function () {
$('#nav-bar').load('nav.html');
$('#footer').load('footer.html');
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.js"></script><script src="assets/js/script.min.js"></script>
</body></html>
