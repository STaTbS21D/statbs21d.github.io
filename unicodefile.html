<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no"><title  id="page-title">STaTbS21D - Spell Coding</title><meta name="description" content="Synoptic Edition of Book of the Dead Spell Sources from the 21st Dynasty (STaTbS21D) is a Digital Humanities project on Egyptology, provides edited and digitalized Book of the Dead spell sources from the end of the New Kingdom and the beginning of the Third Intermediate Period (particularly the 21st Dynasty) for the Egyptological community and the general public.">

<meta property="og:title" content="STaTbS21D - Synoptic Edition of Book of the Dead Spell Sources from the 21st Dynasty" />
<meta property="og:type" content="website" />
<meta property="og:icon" content="assets/img/statbs21d.svg" />
<meta property="og:image" content="assets/img/site.jpg" />
<meta property="og:image:width" content="1067">
<meta property="og:image:height" content="600">
<meta property="og:description" content="Synoptic Edition of Book of the Dead Spell Sources from the 21st Dynasty (STaTbS21D) is a Digital Humanities project on Egyptology, provides edited and digitalized Book of the Dead spell sources from the end of the New Kingdom and the beginning of the Third Intermediate Period (particularly the 21st Dynasty) for the Egyptological community and the general public." />
<link rel="prefetch" href="nav.html"><link rel="prefetch" href="footer.html">
<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700,700i,600,600i&amp;display=swap"><link rel="stylesheet" href="assets/fonts/simple-line-icons.min.css"><link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
<link href="https://db.onlinewebfonts.com/c/0c5e6f133b0b25edfed47aca4ab57676?family=Segoe+UI+Historic" rel="stylesheet"> 
<!--link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Egyptian+Hieroglyphs&display=swap" rel="stylesheet"-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.css">
<link  id="page-css" rel="stylesheet" href="assets/css/styles.min.css">
<script src="assets/js/jquery-3.6.3.js?h=84e399b8f2181ccd73394fdeddff1638"></script>
<script src="assets/js/crypto-js.min.js"></script>
<style>
	#block-content {
		overflow-wrap: break-word !important; 
		word-wrap: break-word !important; 
		white-space: normal !important; 
	}

hiero {
    display: block !important; 
    margin: 0 !important; 
	overflow-wrap: break-word !important;
	font-variant-ligatures: common-ligatures discretionary-ligatures;
}

.hiero {
    display: inline !important;
    white-space: nowrap !important; 
}

@font-face {
  font-family: 'statbs21d';
  src:  url('assets/fonts/statbs21d.eot?enjm2s');
  src:  url('assets/fonts/statbs21d.eot?enjm2s#iefix') format('embedded-opentype'),
    url('assets/fonts/statbs21d.ttf?enjm2s') format('truetype'),
    url('assets/fonts/statbs21d.woff?enjm2s') format('woff'),
    url('assets/fonts/statbs21d.svg?enjm2s#statbs21d') format('svg');
  font-weight: bolder;
  font-style: normal;
  font-display: block;
}

[class^="icon-"], [class*=" icon-"] {
  font-family: 'statbs21d' !important;
  speak: never;
  font-style: normal;
  font-weight: 900;
  font-size: 25px;
  font-variant: normal;
  text-transform: none;
  line-height: 1;

  /* Better Font Rendering =========== */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.icon-Female:before {
  content: "\e909";
}
.icon-Male:before {
  content: "\e90a";
}
.icon-Owner:before {
  content: "\e900";
}
.icon-Family:before {
  content: "\e901";
}
.icon-Source:before {
  content: "\e902";
}
.icon-Script:before {
  content: "\e903";
}
.icon-Vignettes:before {
  content: "\e904";
}
.icon-Sequence:before {
  content: "\e905";
}
.icon-Origin:before {
  content: "\e906";
}
.icon-Dating:before {
  content: "\e907";
}
.icon-Location:before {
  content: "\e908";
}
input[type="radio"] {display: none;}

.switch-container {
    position: relative;
    width: 200px;
    height: 50px;
    background: #3b99e0; /*black;*/
    border-radius: 25px;
    user-select: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    padding: 5px;
    box-sizing: border-box;
  }

  .option {
    flex: 1;
    text-align: center;
    color: black;
    z-index: 2;
    font-weight: 600;
    font-size: 16px;
  }

  .option.left {
    border-radius: 20px 0 0 20px;
  }

  .option.right {
    border-radius: 0 20px 20px 0;
  }

  .slider {
    position: absolute;
    top: 5px;
    bottom: 5px;
    width: 50%;
    background: #fff; /* slightly lighter black for distinction */
    border-radius: 25px;
    transition: left 0.3s ease;
    z-index: 1;
    left: 5px; /* start on left */
  }

  /* Selected text color */
  .switch-container.active-right .option.left {
    color: black;
  }
  
  .switch-container.active-right .option.right {
    color: white;
  }
  
  .switch-container.active-left .option.left {
    color: white;
  }
  
  .switch-container.active-left .option.right {
    color: black;
  }
  */
  /*
  label.option {
    flex: 1;
    text-align: center;
    color: black;
    z-index: 2;
    font-weight: 600;
    font-size: 16px;
    border-radius: 20px;
    cursor: pointer;
    user-select: none;
    transition: color 0.3s ease;
  }

  label.left {
    border-radius: 20px 0 0 20px;
  }

  label.right {
    border-radius: 0 20px 20px 0;
  }

  /* Change slider position and label colors when inputs are checked */
  #option1:checked ~ .slider {
    left: 5px;
  }

  #option2:checked ~ .slider {
    left: 48%;
  }

  #option1:checked ~ label[for="option1"] {
    color: black;
  }

  #option1:checked ~ label[for="option2"] {
    color: white;
  }

  #option2:checked ~ label[for="option2"] {
    color: black;
  }

  #option2:checked ~ label[for="option1"] {
    color: white;
}

.switch {
    position: relative;
    width: 60px;
    height: 10px;
    border-radius: 25px;
    user-select: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    padding: 5px;
    box-sizing: border-box;
	
  }
	
	#sldr {
	position: relative; display: flex; flex-direction: row; align-items: center;
	-webkit-justify-content: center;
  justify-content: center;
  -webkit-align-items: center;
  top: 2em;
	}
	
	.floating {
    position: fixed;
    top: 1em;
    width: 200px;
  }
  .stopped {
    position: absolute;
  }
</style>
</head>

<body>

<script>
window.onload = function() {
document.getElementById("loader").style.display = "none";
document.getElementById("content").style.display = "block";
};

$(document).ready(function() {
  if(window.location.hash) {
    var target = $(window.location.hash);
    if(target.length) {
      $('html, body').animate({
        scrollTop: target.offset().top
      }, 1000);
    }
  }
});
</script>
<svg aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs>
<symbol id="icon-oraec" viewBox="0 0 28 32">
<path d="M7.277 7.029c0.951 0.965 7.754 18.223 8.576 20.777-11.908 2.636-12.213-14.278-8.576-20.777zM21.747 10.919c0.795 4.059 0.869 11.242-1.872 14.48-1.149-1.613-8.31-19.547-8.424-21.363 6.175-0.745 9.083 0.683 10.296 6.883zM10.805 0.332c-9.557 1.611-11.539 10.2-10.59 18.933 1.007 9.266 7.404 14.138 16.791 12.379 9.334-1.749 11.173-10.586 10.352-18.964-0.947-9.669-6.971-13.963-16.553-12.348z"></path>
</symbol>
<symbol id="icon-statbs21d" viewBox="0 0 28 32">
<path d="M20.708 30.382c-0.253 0.254 0.073 0.073 0.077 0.077 0.001 0.001-0.023-0.012-0.023-0.022 0-0.026-0.036-0.073-0.055-0.055zM20.142 29.816c0-0.447 0.232-0.018 0.112 0-0.002 0-0.112 0.48-0.112 0zM21.037 28.478c0.211-0.483 0.169-0.646 0-1.1-0.224 0.451-0.224 0.649 0 1.1zM20.708 26.984c-0.328 1.366 0.295 1.377-0.329 1.872-0.082-2.261-0.11-1.701 0.329-1.872zM7.403 28.335c-0.496-0.198-0.655 0.1-0.381-0.832 0.1-0.339 0.358-0.681 0.611-0.88l-0.23 1.712zM20.708 26.418v0zM7.871 24.152v0zM4.496 20.804c-0.227 0.227 0 0 0 0zM4.9 19.67c-0.294 0.294 0.291-0.291 0 0zM20.897 19.243c0.794-0.305 0.159 0.167 0.629-0.184 0.278-0.208-0.082-0.126 0.456-0.555l-0.032 1.98c-0.005 0.544-0.171 1.092-0.437 1.574-0.221-2.015 0.591-1.982-0.615-2.816zM21.086 18.677c0.018-0.018 0.055 0.029 0.055 0.055 0 0.011 0.023 0.023 0.023 0.022-0.004-0.004-0.331 0.177-0.077-0.077zM22.030 18.332c-0.46-0.379-0.213-1.239-0.14-1.904 0.355 0.476 0.308 1.487 0.14 1.904zM11.269 16.6v0zM7.871 24.152c0.288-0.415 0.306-0.9 0.555-1.695 0.527-1.686 0.629-5.025 2.277-5.856-0.356 1.471-1.29 2.995-1.682 4.737l-1.338 5.113c-0.286-0.51 0.101-2.108 0.189-2.298zM10.702 16.6v0zM22.030 16.255c-0.36-0.627-0.134-0.781 0-1.354 0.196 0.315 0.152 1.069 0 1.354zM20.331 15.845c-0.392 0.259-0.015 0.177-0.772 0.205-0.415-0.781 0.046-0.214-0.156-0.788-1.042 0.467 0.254 0.132-0.788 0.599l-0.616-0.549c-0.576 0.797-0.675 0.548-1.822 0.532-0.872-0.012-1.77 0.293-2.141 0.254-0.036-0.541 0.561-0.803 0.13-1.732l-0.735 1.798-0.998 0.004c-0.64 0.162 0.153 0.406-1.164 0.431 0.124-1.448 1.064-1.914 1.297-3.185-1.581 0.296-0.017 0.26-2.302 2.59-0.412-0.866-0.135-1.373-1.191-2.118-1.184-0.834-1.696-0.048-2.769-0.439-0.474-0.737 0.593-0.394 0.18-0.875-0.012-0.014-0.746-0.465-0.831-0.556-0.851-0.918-0.216-1.051-0.215-1.816-0.114 0.416-0.295-0.307-0.751-0.604 1.117 2.252 1.438-0.164 0.751 0.604 0.086 0.802 0.558 1.398 0.755 2.849 0.362 1.201-1.49 5.83-2.085 6.945-0.931 1.745-0.106 3.666-2.934 3.67-1.316-0.023 0.207-0.119-0.972-0.272-0.15 0.379-0.317 0.389-0.087 0.783 1.282 0.213 2.17 0.142 3.466-0.729 0.978-0.657 0.86-0.521 1.080-1.531 0.407-0.957 0.275-0.562 0.596-1.323l1.020-3.237c0.336-1.074 1.058-2.305 1.237-3.559 0.821 0.249-0.134 0.052 0.77 0.396 0.281 0.107 0.207-0.056 0.753 0.29 0.089 0.75-0.439-0.305 0.2 0.703 0.569 0.897-0.396-0.335 0.124 0.863 0.064 0.148 0.432 0.5 0.567 0.679-1.862 2.89-1.347 2.546-1.838 4.971-0.115 0.568-2.073 6.274-2.123 7.189l1.318 0.358c-0.103 0.563-0.14 1.425-0.357 1.891 1.168-0.015 0.905-1.044 0.966-2.071 0.049-0.831 0.191-1.487 0.24-2.301 0.045-0.742 0.511-1.431 0.673-2.245 0.186-0.934 0.355-1.733 0.561-2.649 0.311-1.384 0.567-3.773 2.198-4.044 1.37-0.228 3.688-0.114 4.893-0.793-0.513-0.281-4.348 0.447-5.263 0.466 0.203-1.040 7.342-1.641 8.159-1.080-0.275 0.151-1.435-0.109-2.382 0.395 0.634 0.383 1.948-0.16 3.102 0.042l0.499 1.744c-0.977 0.58-2.268 0.148-2.79 0.768l2.46-0.054c0.178 0.702-0.177 4.152-0.374 4.941-2.697 0.745-9.194 0.049-10.286 0.658 0.585 0.013 0.411 0.095 0.96 0.108l3.754-0.006c1.744-0.079 3.302 0.147 4.332-0.1 0.778-0.187 0.050-0.043 0.653-0.090 0.272-0.021 0.324 0.056 0.627-0.103 0.034 0.42-0.024 0.437-0.030 0.655l-0.084 2.39c-0.097 0.891-0.241 2.518-0.195 3.345 1.010-0.053 0.247 0.141 0.69-0.722 0.089 0.788-0.279 0.697 1.142 0.715 0.080-0.765 0.297-1.443 0.281-2.147-0.051-2.268-0.371-0.573-0.108-2.335-0.657 0.476-0.288 0.596-0.895 0.361l0.427-0.354-0.427-0.212c-0.529-1.148 0.041-4.765 0.237-6.592 0.676 1.226-0.346 1.993 0.189 3.366l0.413-0.934c0.14 0.797-0.107 2.639-0.256 3.421-0.762 0.124 0.407-0.799-0.55-0.14 0.357 0.718 0.129 0.489 0.847 0.847 0.783-0.768 0.188-0.501 0.285-1.174 0.054-0.374 0.156-1.265 0.223-1.915 0.059-0.573 0.089-1.016 0.12-1.781l0.435-3.533c0.3-0.906 0.144-1.805 0.099-3.061-0.453-0.954 0.343-1.376-0.006-2.604 0.052-2.142 0.312-0.283-0.295-1.965-0.22-0.634-0.408-1.78-0.408-2.711-1.318 0.027-0.457 0.821-0.27 2.058 0.147 0.973-0.17 1.111 0.246 2.041-0.249 1.248 0.034-0.12-0.301 2.764-0.131 1.133-0.127 2.523-0.44 3.072l-0.944-1.731zM16.555 6.595c0.19-0.19 0.578 0.246 0.209 0.097-0.004-0.002-0.464 0.157-0.209-0.097zM12.811 0.586c0.577 0.006 0.761 0.308 1.141 0.681 0.454 0.446 2.537 2.977 2.036 3.85-1.005-0.77-0.642-1.373-1.529-2.279-0.955-0.976-1.013-1.122-1.648-2.252zM17.688 0.553c0.19-0.19 0.578 0.246 0.209 0.097-0.004-0.002-0.464 0.157-0.209-0.097zM10.136 4.518c0.656 0.584 0.537 0.202 1.273 0.55-0.214-1.487-3.283-2.658-3.037-3.636 0.628-0.043 0.928 0.916 1.953 1.009-0.311-1.15-0.604-0.764-1.293-1.26 1.468-1.067 2.96 0.938 4.074 2.444 0.952 1.287 0.47 1.189 1.204 1.471 0.321-0.604-0.784-1.776-1.289-2.33-0.775-0.85-1.691-1.512-1.727-2.188 0.966 0.029 2.565 2.182 3.088 3.093 0.206 0.359 0.403 0.93 0.696 1.413l-0.41 0.378 1.149-0.005c0.526 0.927 0.265 1.781-0.431 2.642 0.852 0.453-0.036-0.228 0.799 0.171-0.194 0.801-0.534 3.812-0.196 4.397 0.58-1.005 0.212-4.631 0.812-5.478 0.266 0.363 0.249 2.069 0.178 2.821-0.043 0.454-0.133 0.138-0.22 0.928-0.094 0.856-0.496 4.053-0.203 4.561 0.514-0.821 0.453-2.304 0.68-3.882 0.105-0.731 0.070-1.544 0.134-2.302l0.087-0.748c0.299-1.566-0.271-2.592-0.708-3.675-0.532-1.318-1.418-3.013-2.426-4.026 2.074-1.068 2.589 1.361 3.371 4.002 0.224 0.757-0.195 1.106 0.75 1.726-0.031-1.478-0.516-1.967-0.785-3.179-0.234-1.053-0.725-1.856-0.885-2.661 1.054 0.061 1.242 0.841 1.747 2.365 0.278 0.838 0.468 3.142 0.686 3.513 1.151-1.014-1.016-5.145-1.090-5.711 0.729 0.609 1.009 0.865 1.451 1.718 0.532 1.027 0.148 1.946 0.932 2.237-0.175-0.916-0.226-1.772-0.742-2.574 0.777 0.104 1.038 1.592 1.302 2.565 0.008 0.029 0.024 0.081 0.031 0.11 0.225 0.965 0.119 3.381 0.848 3.681 0.514-0.94-0.843-5.996-1.532-7.045-0.327-0.499-2.070-1.422-3.414-1.426-0.721-0.002-0.395-0.279-1.889-0.152l-2.624 0.031c-0.858-0.019-2.438 0.45-3.437 0.716-0.979 0.261-1.802 1.076-2.114 2.115 1.183 0.423-0.546-1.952 3.349 1.104 0.088 0.806 0.007 0.292-0.14 0.518zM12.402 6.028v0zM12.402 6.028c-0.365-0.554-0.283-0.189-0.254-0.631 0.493-0.034 0.455 0.249 0.96 0.615-0.15-1.022-2.114-2.548-2.784-3.571 0.639 0.071 1.565 1.121 2.064 1.711l1.523 2.097c0.478-0.61 0.121-0.547 0.755-0.788-0.043 2.020-0.152 0.316 0.156 1.856-0.744-0.147-0.184-0.128-0.578-0.278l-2.495-0.365c-2.116-0.658-2.153-1.188-5.218-0.663-0.516 0.932-0.316 2.143-1.683 2.47 0.238-0.657 0.007-0.066 0.353-0.591 0.852-1.292 0.413-0.913 0.844-2.337 0.378-1.25 0.2-3.713 2.141-2.308 0.558 0.404 1.068 0.604 1.382 1.083l-1.149 0.205c-0.224-0.529-0.379-1.177-1.257-1.289-0.526 0.724 0.195 0.343-0.599 2.357 0.972 0.089 0.561-0.192 1.678-0.361 1.513-0.23 0.345 0.077 1.52 0.181 0.975 0.086 0.361-0.449 1.357 0.38 0.856 0.712 0.147 0.33 1.281 0.227zM7.115 7.539c-0.041 0.113 0.251 0.457 0.451 0.028 0.216-0.462-0.143-0.044-0.174-0.047-0.016-0.002-0.255-0.040-0.277 0.019zM6.216 8.29c-0.035-1.964 2.886-1.811 3.768-1.322-0.352 0.147-0.505-0.015-1.166 0.049 0.541 0.71 0.67 1.263 1.51-0.082 1.43 0.911 1.434-0.378 3.177 0.542-1.69 1.639-1.4-0.3-3.149 0.274-0.52 0.171-1.316 0.486-1.862 0.598-0.512 0.106-1.112-0.104-1.609-0.574-0.679 0.177 0.029-0.070-0.669 0.513zM8.831 26.558c0.234-0.116 2.174-0.393 2.496-0.375 1.398 0.077 7.269-0.5 7.887-0.159-0.219 0.509 0.004 0.279-0.58 0.398l-2.2 0.037c-0.982-0.021-0.749 0.102-1.262 0.169l-3.475-0.144c-0.782 0.075-2.329 0.382-2.866 0.074zM20.331 15.845c-0.508-0.198-0.219 0.215-0.378-0.378 0-0.574-0.057-0.926 0.103-1.413 0.786-2.399 0.167-0.186 0.424-2.804 0.030-0.303 0.128-1.064 0.127-1.255-0.004-1.433-0.621-2.774 0.29-3.024 0.001 0.855 0.189 1.463 0.161 2.266l-0.101 2.038c-0.073 1.866-0.626 2.767-0.626 4.57zM10.735 18.742c0.634-0.47 1.789-0.404 2.613-0.444 1.853-0.089 4.722-0.628 4.746-0.629 1.733-0.073 1.502-0.32 2.049-0.125-0.613 1.216-0.369 0.22-2.087 0.542-0.795 0.149-6.607 0.882-7.321 0.656zM11.080 21.32c0.177-0.418 0.263-0.49 0.969-0.528 0.698-0.038 0.37 0.116 1.114 0.144l2.64-0.179c0.713-0.030 1.556-0.256 2.178-0.326 0.932-0.105 1.461-0.456 1.972 0.323l-2.379 0.090c-0.668 0.058-1.492 0.225-2.023 0.248l-4.471 0.229zM14.667 10.37c-0.505 0.36-0.902 1.865-0.976 2.611-0.691-0.114-0.429-0.245-1.052 0.205-0.009-0.357 1.738-4.131 2.562-4.294 0.053 0.68 0.152 0.804-0.157 1.289l-0.352-0.363-0.026 0.552zM19.436 13.72c-0.504-0.693-0.095-0.931-0.047-1.837l-0.058-3.691c-0.108-1.153 0.1-0.928 0.402-0.999l0.082 6.079c-0.23 0.8 0.122 0.287-0.379 0.448zM12.024 23.176c0.626 0.735 1.069 0.222 3.97 0.227 1.046 0.002 3.032-0.598 3.738-0.129-0.741 0.322-3.48 0.44-4.162 0.358-0.815-0.099-2.032 0.176-3.048 0.247-1.187 0.083-0.827 0.264-1.269-0.276l0.209-0.034c0.635-0.115 0.416-0.076 0.562-0.392zM12.181 27.55c0.587-0.337 1.339-0.167 2.119-0.185 1.725-0.040 3.681-0.572 5.26 0.045-0.828 0.41-1.325 0.048-2.43 0.123l-3.223 0.013c-1.426 0.008-1.189 0.28-1.725 0.004zM8.437 30.76c2.075 0 4.164-0.025 6.237-0.007 1.273 0.011 1.557 0.41 2.835 0.018 1.389-0.427 1.501-0.159 1.873 0.365l-10.946-0.375zM18.066 14.934c-0.481-0.839-0.059-0.51 0.066-1.052l0.039-1.126c0.1-0.752 0.131-2.002 0.462-2.606 0.413 0.719 0.076 1.766-0.009 2.666-0.027 0.285-0.14 1.046-0.208 1.317l-0.349 0.801zM9.947 22.264c0.56-0.389 4.373-0.239 5.27-0.14-0.457 0.613-1.857 0.126-2.628 0.127l-1.409 0.086c-0.82-0.027-0.629 0.195-1.233-0.073zM14.667 10.371l0.377-0.189c0.002 0.868-0.2 1.665-0.287 2.457-0.165 1.504-0.106 1.256-0.484 1.523-0.331-0.616 0.112-1.351 0.21-1.709l0.184-2.083zM15.832 22.011c0.209-0.097 1.535-0.263 1.997-0.36 0.527-0.111 1.314-0.324 1.902 0.112-0.336 0.157-3.473 0.565-3.9 0.248zM16.037 30.145c-0.286-0.393-0.275-0.701-0.122-1.145 0.24-0.695 0.015-0.528 0.812-0.458-0.638 1.329 0.548 1.609-0.69 1.602zM18.632 10.025c-0.386-0.677-0.268-0.887-0.268-1.431 0.001-0.503-0.187-0.982 0.079-1.466 0.394 0.684 0.617 2.151 0.189 2.897zM9.743 30.021c-0.062-0.172-0.124-0.678-0.096-0.922 0.172-1.531 1.918 0.654 0.096 0.922zM15.422 15.5c-0.407-0.71 0.037-2.039 0.426-2.659 0.242 0.487-0.020 2.144-0.426 2.659zM18.492 29.988c-0.334-0.854-0.508-1.442 0.469-1.634 0.456 0.637 0.189 0.134-0.028 0.968-0.18 0.69 0.485 0.177-0.441 0.667zM10.924 29.692c0.329-0.711 0.064-0.75 0.739-1.025 0.404 0.839-0.515 0.106 0.329 1.025-1.479 0.77 0.722-0.178-0.612 0.667l-0.456-0.667zM12.056 19.745c0.277-0.128 3.042-0.319 3.539-0.264-0.6 0.294-2.906 0.733-3.539 0.264zM14.856 30.226c-0.543-0.871-0.237-1.576 0.361-1.683-0.17 0.434 0.091 0.941 0.161 1.407l-0.523 0.276zM13.281 30.161c-0.904-0.63-0.381-1.648-0.189-1.823 0.528 0.712 0.126 0.561 0.238 1.029 0.061 0.252 0.538 0.003-0.050 0.795zM12.386 15.861c-0.149-0.462 0.529-1.99 0.82-2.454 0.168 0.407 0.043 0.646-0.156 1.183-0.403 1.092-0.059 0.999-0.664 1.271zM21.086 25.128c-0.741-0.615-0.357-1.118 0.049-1.715 0.324 0.655 0.070 0.398 0.047 0.981-0.029 0.719 0.214 0.136-0.096 0.734zM9.209 27.599c0.547-0.060 0.952-0.035 1.504-0.045 0.712-0.012 0.788-0.146 1.156-0.004-0.406 0.233-1.75 0.342-2.183 0.304-0.344-0.031-0.108 0.21-0.476-0.255zM17.147 29.971l0.336-1.493c0.449 0.193 0.229-0.043 0.326 0.326l-0.026 0.486c-0.091 0.616-0.142 0.583-0.636 0.68zM15.8 19.432c0.909 0 0.699-0.248 1.683-0.14-0.651 0.485-0.803 0.329-1.683 0.329v-0.189zM6.862 11.757c-0.046-0.303-0.071-0.079 0.017-0.327 0.098-0.275 0.118-0.164 0.268-0.338l0.502 0.476c-0.51 0.371-0.312 0.31-0.788 0.189zM4.711 9.836c-0.589-0.494-0.205-1.373 0.462-1.458l-0.462 1.458zM20.709 6.249c-0.443-0.561-0.478-0.466-0.189-1.009 0.44 0.557 0.488 0.475 0.189 1.009zM13.723 8.671c0.062-0.714 0.086-0.987 0.728-1.091l-0.728 1.091zM21.782 7.788l-0.318-0.816c0.662 0.060 0.646 0.268 0.318 0.816zM10.136 23.774c0.457-0.291 0.227-0.218 0.928-0.14-0.478 0.356-0.366 0.39-0.928 0.14zM10.924 19.826c0.095-0.073-0.065-0.447 0.707-0.065-0.528 0.301 0.101 0.223-0.707 0.065zM19.010 14.335c0.455-0.281-0.034-0.374 0.599 0-0.503 0.297-0.119 0.316-0.599 0zM9.947 22.264c-0.148 0.457 0.131 0.303-0.254 0.254-0.044-0.341-0.289-0.13 0.254-0.254zM10.325 21.131c-0.256-0.256 0.213-0.099 0.218-0.101 0.379-0.142-0.035 0.284-0.218 0.101zM13.723 8.86l-0.377-0.101 0.377-0.088v0.189zM13.723 8.86l0.188 0.064-0.139 0.109-0.049-0.173zM18.443 6.595l0.188 0.064-0.139 0.109-0.049-0.173zM18.254 22.831c-0.254-0.254 0.073-0.073 0.077-0.077 0.001-0.001-0.023 0.033-0.023 0.023 0-0.026-0.036 0.073-0.055 0.055zM2.018 23.397c-0.256-0.256 0.058 0.058 0 0zM14.479 24.152c-0.254-0.254 0.073-0.073 0.077-0.077 0.001-0.001-0.022 0.033-0.022 0.022 0-0.026-0.036 0.073-0.055 0.055zM7.304 3.951c-0.254-0.254 0.072-0.073 0.077-0.077 0.001-0.001-0.022 0.033-0.022 0.023-0-0.026-0.037 0.073-0.055 0.055zM10.136 4.518v0z"></path>
</symbol>
</defs>
</svg>

<div id="loader" style="position: fixed;top: 50%;left: 0;width: 100%;height: 100%;background-color: #fff;z-index: 9999;"><img src="assets/img/loading.gif" alt="Loading..." style="display: block;margin: auto;">
<p style="text-align: center;">Loading...</p></div>

<div id="content" style="display:none;">

<nav id="nav-bar" class="navbar navbar-light navbar-expand-lg sticky-top bg-white clean-navbar" style="position: relative;overflow: visible;display: inline;"></nav>

<main class="page faq-page">

<section class="clean-block clean-faq dark">
<div align="center" id="sldr">
  <div class="switch">
    <svg class="icon icon-statbs21d"><use xlink:href="#icon-statbs21d"></use></svg>
  </div>
  <div class="switch-container" role="radiogroup" aria-label="Option selector">
    <input type="radio" id="option1" name="switch" value="statbs21d">
    <input type="radio" id="option2" name="switch" value="oraec">   
    <label class="option left" for="option1" tabindex="0" role="radio" aria-checked="false">STaTbS21D</label>
    <label class="option right" for="option2" tabindex="0" role="radio" aria-checked="false">ORAEC</label>   
    <div class="slider"></div>
  </div>
  <div class="switch">&nbsp;
    <svg class="icon icon-oraec"><use xlink:href="#icon-oraec"></use></svg>
  </div>
</div>

<script>
  const inputs = document.querySelectorAll('input[name="switch"]');
  const labels = document.querySelectorAll('label.option');

  function updateAria() {
    inputs.forEach((input, idx) => {
      labels[idx].setAttribute('aria-checked', input.checked ? 'true' : 'false');
    });
  }

  // Set switch based on URL parameter 'src'
  function setSwitchFromSrc(src) {
    if (src === "oraec") {
      document.getElementById('option2').checked = true;
    } else {
      document.getElementById('option1').checked = true;
    }
    updateAria();
  }

  inputs.forEach(input => {
    input.addEventListener('change', () => {
      updateAria();
      // Reload content when switch is changed
      loadContent();
    });
  });

  // Keyboard accessibility for labels
  labels.forEach(label => {
    label.addEventListener('keydown', e => {
      if (e.key === ' ' || e.key === 'Enter') {
        e.preventDefault();
        document.getElementById(label.getAttribute('for')).checked = true;
        updateAria();
        loadContent();
      }
    });
  });

  // initialize aria states correctly on load
  updateAria();
</script>

<div id="markdownContent" class="container">
  <div id="loader" align="center"><br><br><div class="block-content"><img src="assets/img/loading.gif" /></div></div>
</div>
<div class="container"><div id="TbPContent" class="block-content"></div></div>
</section>

<script>
  //$(document).ready(function () {
    const urlParams = new URLSearchParams(window.location.search);
    const TM = 'TM ' + urlParams.get("id"); // TM '135240'
    const Spell = 'Spell ' + urlParams.get("spell"); // Spell '194'
    var src = urlParams.get("src");
    
    // Set the switch based on URL parameter 'src'
    setSwitchFromSrc(src);

    // Main function to load content based on current switch and parameters
    function loadContent() {
      var fte = $('input[name="switch"]:checked').val();
      var lead = (fte === "statbs21d") ? "Unicode" : "ORAEC";
      var githubURL = 'https://raw.githubusercontent.com/STaTbS21D/Book_of_the_Dead_Sources/main/' + Spell + '/' + lead + '/';

      // Fetch the tree from GitHub API to find the right markdown file
      var owner = 'STaTBS21D';
      var repo = 'Book_of_the_Dead_Sources';
      var tokenEncrypted = 'U2FsdGVkX18RuJN5XTj898CCXpHsKmJu1CbYQQEHv/Xp0dK5lzFaVYJD8S+7c8+tPZraAcAIlnCYNsXwDh4e8zncRnWT3883LudltXWh6SKlZ+Jv3aB4t5gT/TLY3rj2+h3XNKUDB4Y+x2WACRYTiQ==';
      var password = 'senerpaitui';
      var decryptedBytes = CryptoJS.AES.decrypt(tokenEncrypted, password);
      var token = decryptedBytes.toString(CryptoJS.enc.Utf8);

      $.ajax({
        url: `https://api.github.com/repos/${owner}/${repo}/git/trees/main?recursive=1`,
        headers: {'Authorization': 'Bearer ' + token, 'X-GitHub-Api-Version': '2022-11-28'},
        success: function(response) {
          var folderList = {};
          $.each(response.tree, function(index, item) {
            if (item.type === 'blob' && item.path.includes(lead + '/')) {
              var rootFolder = Spell;
              if (rootFolder) {
                if (!folderList[rootFolder]) folderList[rootFolder] = [];
                folderList[rootFolder].push(item.path);
              }
            }
          });

          var unicodefile = '';
          $.each(folderList, function(folder, files) {
            $.each(files, function(index, file) {
              var segments = file.split('/');
              var ind = segments.indexOf(Spell);
              if (ind !== -1 && segments.length > ind + 1) {
                var unicodef = segments[ind + 2];
                if (unicodef.startsWith(TM)) {
                  unicodefile = unicodef;
                  return false;
                }
              }
            });
          });

          if (!unicodefile) {
            $('#markdownContent').html('<section class="clean-block"><br><br><div class="block-content" align="center"><p class="text-bg-danger small" style="width:60%;border-radius: 18px;text-align: center">' + Spell + ' is not available for the given source (' + TM + ').</p></div></section>');
            return;
          }

          var fileURL = 'https://raw.githubusercontent.com/STaTbS21D/Book_of_the_Dead_Sources/main/' + Spell + '/' + lead + '/' + unicodefile;

          // Load markdown file
          $.ajax({
            url: fileURL,
            success: function(data) {
              var htmlContent = parseMarkdown(data);
              $('#markdownContent').html(htmlContent);
              downloadlinks(unicodefile);
              $('#loader').hide();
            },
            error: function() {
              $('#markdownContent').html('<section class="clean-block"><br><br><div class="block-content" align="center"><p class="text-bg-danger small" style="width:60%;border-radius: 18px;text-align: center">Error loading the file.</p></div></section>');
            }
          });
        },
        error: function() {
          $('#markdownContent').html('<section class="clean-block"><div class="block-content"><div align="center"><p class="text-bg-danger small" style="width:60%;border-radius: 18px;text-align: center">Error fetching files from GitHub repository.</p></div></div></section>');
        }
      });

    }

    // Parser modified to avoid numbering empty <br> inside <hiero> and reduce font size of notes
    function parseMarkdown(mdContent) {
      var lines = mdContent.split('\n');
      var htmlContent = '<div class="block-heading">';
      var lineNumber = 0;

      for (var i = 0; i < lines.length; i++) {
        var line = lines[i];

        if (line.startsWith('##')) {
          htmlContent += '<h4 class="unicode">' + line.substring(2).trim() + '</h4>';
        } else if (line.startsWith('#')) {
          htmlContent += '<h2 class="text-info">' + line.substring(1).trim() + '</h2></div><div id="block-content" class="block-content">';
          var newTitle = 'STaTbS21D - ' + line.substring(1).trim();
          document.title = newTitle;
        } else if (line.startsWith('http')) {
          var regex = /((?:https?|ftp):\/\/[^\s]+)/g;
          htmlContent += line.replace(regex, '<a href="$1" target="_blank">$1</a>');
        } else {
          if (line.startsWith('<hiero>')) {
            lineNumber = 1;
            htmlContent += '<hiero><span class="hiero"><sup>' + lineNumber + '</sup>| </span>' + line.trim().substring(7);
          }
          else if ((line.endsWith('<br>') || line.endsWith('<br></hiero>')) && lineNumber > 0) {
            // Only increment line number if not an empty <br> (line with no content except <br>)
            var contentWithoutTags = line.replace(/<br[^>]*>/gi, '').trim();
            if (contentWithoutTags.length > 0) {
              lineNumber++;
              if (line.endsWith('</hiero>')) {
                htmlContent += "<span class='hiero'><sup>" + lineNumber + "</sup>| </span>" + line.trim().replace('</hiero>', '');
              } else {
                htmlContent += "<span class='hiero'><sup>" + lineNumber + "</sup>| </span>" + line.trim();
              }
            } else {
              // Just add the <br> without numbering
              htmlContent += line.trim();
            }
          }
          else if (line.trim() === '</hiero>') {
            htmlContent += '</hiero>';
            lineNumber = 0;
          }
          else {
            // Reduce font size of notes, assuming notes contain class "note" or similar (example: use a span with smaller font size)
            if (line.toLowerCase().includes('note')) {
              htmlContent += '<div style="font-size:0.85em;">' + stripURLs(line.trim()) + '</div>';
            } else {
              htmlContent += stripURLs(line.trim());
            }
          }
        }
      }
      htmlContent += '</div>';
      return htmlContent;
    }

    function stripURLs(text) {
      var replacedText = text.replace(/\[(.*?)\]\((.*?)\)/g, function(match, p1, p2) {
        if (/^(http|https):\/\//.test(p1)) {
          return match;
        } else {
          return '<a href="' + p2 + '" target="_blank">' + p1 + '</a>';
        }
      });
      replacedText = references(replacedText);
      replacedText = replacedText.replace(/-!/g, '<br>');
      return replacedText;
    }

    function references(ref) {
      const regex = /(\(?[A-Za-záéíóúüñńÁÉÍÓÚÜÑŃ]+(?:\s+[A-Za-záéíóúüñńÁÉÍÓÚÜÑŃ]+)*\s*,\s*\d{4}\s*(?:,\s*\d+(?:-\d+)?)?\)?)|([A-Za-záéíóúüñńÁÉÍÓÚÜÑŃ]+(?:\s+[A-Za-záéíóúüñńÁÉÍÓÚÜÑŃ]+)*\s*\(\d{4}\s*(?:,\s*\d+(?:-\d+)?)?\))|([A-Za-záéíóúüñńÁÉÍÓÚÜÑŃ]+(?:\s+[A-Za-záéíóúüñńÁÉÍÓÚÜÑŃ]+)*\s*(?:&|y)?\s*[A-Za-záéíóúüñńÁÉÍÓÚÜÑŃ]+(?:\s+[A-Za-záéíóúüñńÁÉÍÓÚÜÑŃ]+)*\s*,\s*\d{4})/g;
      var textoModificado = ref.replace(regex, function(match) {
        let query = match.replace(/[(),:]/g, '');
        let yearMatch = query.match(/\d{4}/);
        let authorMatch = query.match(/^[^,\d]+/);
        if (yearMatch && authorMatch) {
          query = `${authorMatch[0]}${yearMatch[0]}`;
        } else {
          query = match.replace(/[(),:]/g, '').replace(/\s+/g, '+');
        }
        query = query.replace(/\s+/g, '+');
        return `<a href="references.html?q=${query}" target="_blank">${match}</a>`;
      });
      return textoModificado;
    }

    function downloadlinks(unicodefile) {
      var URLj = URLi + '/JSesh/' + unicodefile.slice(0, -2) + 'gly';
      var URLu = URLi + '/Unicode/' + unicodefile;
      var URLo = URLi + '/ORAEC/' + unicodefile;
      var html = '<div class="dropdown" align="right"><button class="btn btn-outline-primary dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button">Download</button><div class="dropdown-menu"><a class="dropdown-item" data-link="' + URLj + '" onclick="downloadFile(this)"><svg xmlns="http://www.w3.org/2000/svg" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd; align:right" viewBox="0 0 1263.36 1656.74" height="2em" fill="currentColor"><path d="M872.06 960.62c-26.21,4.29 -45.8,23.47 -50.45,49.85 -5.58,31.63 11.46,48.23 31.35,68.26l75.59 75.81c14.82,15.32 17.14,10.04 1.23,25.69 -17.17,16.88 -90.96,88.85 -99.76,102.99 -33.77,54.28 27.85,116.8 81.67,86.75 16.47,-9.2 84.43,-80.47 102.83,-98.88 16.89,-16.9 33.7,-34 50.72,-50.76 20.29,-19.97 33.82,-42.89 22.86,-72.38 -7.4,-19.9 -31.39,-39.54 -46.65,-54.81l-101.45 -101.51c-21.57,-21.64 -34.01,-36.58 -67.95,-31.01z"/><path d="M374.71 960.66c-25.95,4.35 -40.79,23.89 -58.55,41.67l-100.83 100.88c-19.19,19.14 -37.81,33.6 -38.68,63.02 -0.92,31.05 16.27,44.31 36.18,64.17l101.45 101.51c16.56,16.57 34,38.75 57.5,44.05 58.46,13.19 100.88,-55.71 57.6,-104.07 -15.05,-16.81 -33.82,-34.1 -49.97,-50.25 -7.61,-7.61 -47.83,-45.7 -50.89,-50.75 -3.57,-5.9 15.04,-20.56 19.58,-25.06l75.81 -75.78c44.46,-43.54 15.45,-120.21 -49.2,-109.38z"/><path style="stroke:currentColor;stroke-width:40;stroke-miterlimit:20" d="M1213.13 416.24c4.74,17.03 7.2,34.75 7.2,52.68l0 949.61c0,108.06 -88.42,196.44 -196.44,196.44l-785.65 0c-108.5,0 -196.44,-87.97 -196.44,-196.44l-0.04 -1178.57c0,-108.5 87.94,-196.44 196.44,-196.44l556.73 0c18.16,0 36.08,2.54 53.3,7.41l0 219.48c0,80.2 65.62,145.82 145.82,145.82l219.07 0zm-277.99 -316.94l229.07 229.07c36.82,36.9 57.39,86.94 57.39,138.79l0 949.61c0,108.06 -88.42,196.44 -196.44,196.44l-785.65 0c-108.5,0 -196.44,-87.97 -196.44,-196.44l-0.04 -1178.57c0,-108.5 87.94,-196.44 196.44,-196.44l556.73 0c51.89,0 101.9,20.71 138.94,57.54z"/><path d="M449.88 867.02l0 -160.24c0,-15.1 0.49,-31.67 1.39,-49.77l0.63 -13.43 -2.44 0c-4.32,22.97 -7.66,38.84 -9.95,47.68l-43.09 175.76 -82.77 0 -45.04 -173.68c-1.25,-4.38 -4.46,-20.95 -9.61,-49.77l-2.44 0c1.88,45.66 2.85,74.2 2.85,85.62l0 137.83 -77.27 0 0 -292.36 131.91 0 40.16 158.71c0.98,3.27 2.23,9.89 3.83,19.91 1.53,9.95 2.51,17.68 2.92,23.11l1.25 0c1.46,-12.39 3.83,-26.94 7.1,-43.78l37.52 -157.95 129.89 0 0 292.36 -86.87 0z"/><path id="1" d="M725.89 867.02l0 -24.22 -0.84 0c-6.89,9.05 -15.94,16.22 -27.08,21.44 -11.21,5.22 -22.21,7.8 -33.07,7.8 -17.82,0 -33.55,-4.38 -47.13,-13.16 -13.57,-8.77 -23.73,-21.02 -30.49,-36.75 -6.75,-15.8 -10.09,-34.39 -10.09,-55.83 0,-22.14 4.04,-41.77 12.04,-58.89 8,-17.12 19.28,-30.42 33.83,-39.96 14.55,-9.54 30.91,-14.27 48.93,-14.27 8.63,0 16.5,1.25 23.81,3.69 7.24,2.44 13.57,5.71 18.93,9.88 5.36,4.11 8.84,8.21 10.3,12.32l0.84 0 0 -121.12 86.87 0 0 309.07 -86.87 0zm1.81 -110.75c0,-12.53 -2.71,-22.28 -8.21,-29.17 -5.5,-6.96 -12.95,-10.44 -22.35,-10.44 -9.4,0 -17.05,4.32 -22.97,12.95 -5.92,8.63 -8.84,20.19 -8.84,34.6 0,29.59 10.16,44.34 30.56,44.34 9.68,0 17.4,-3.97 23.18,-11.97 5.78,-7.94 8.63,-19.56 8.63,-34.8l0 -5.5z"/><path id="2" d="M1080.13 859.01c-24.22,8.7 -52.14,13.02 -83.81,13.02 -31.12,0 -57.99,-5.92 -80.54,-17.82 -22.55,-11.9 -39.82,-28.82 -51.72,-50.82 -11.9,-21.93 -17.82,-47.26 -17.82,-75.95 0,-30.84 6.68,-58.33 19.98,-82.35 13.3,-24.08 32.16,-42.67 56.52,-55.76 24.29,-13.16 52.28,-19.7 83.95,-19.7 25.34,0 49.77,3.06 73.44,9.19l0 81.44c-8.14,-4.87 -17.89,-8.7 -29.17,-11.42 -11.28,-2.71 -22.69,-4.04 -34.25,-4.04 -23.94,0 -42.81,6.89 -56.66,20.6 -13.78,13.72 -20.67,32.3 -20.67,55.83 0,23.39 6.89,41.84 20.67,55.34 13.85,13.51 32.3,20.26 55.41,20.26 21.37,0 42.88,-5.43 64.67,-16.29l0 78.45z"/></svg> JSesh file</a><a class="dropdown-item" data-link="' + URLu + '" onclick="downloadFile(this)"><svg xmlns="http://www.w3.org/2000/svg" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd; align:right" viewBox="0 0 4074.03 5342.59" height="2em" fill="currentColor"><path style="stroke:currentColor;stroke-width:140;stroke-miterlimit:120" d="M3912.04 1342.29c15.29,54.93 23.23,112.05 23.23,169.88l0 3062.26c0,348.46 -285.14,633.47 -633.47,633.47l-2533.53 0c-349.9,0 -633.47,-283.69 -633.47,-633.47l-0.12 -3800.59c0,-349.9 283.58,-633.47 633.47,-633.47l1795.31 0c58.55,0 116.35,8.2 171.88,23.91l0 707.77c0,258.64 211.6,470.24 470.24,470.24l706.45 0zm-896.45 -1022.06l738.69 738.69c118.74,118.99 185.06,280.35 185.06,447.57l0 3062.26c0,348.46 -285.14,633.47 -633.47,633.47l-2533.53 0c-349.9,0 -633.47,-283.69 -633.47,-633.47l-0.12 -3800.59c0,-349.9 283.58,-633.47 633.47,-633.47l1795.31 0c167.35,0 328.6,66.79 448.05,185.54z"/><path style="stroke:currentColor;stroke-width:50;stroke-miterlimit:50" d="M2668.52 3806.24c-194.76,-292.18 -314.47,-443.66 -359.11,-454.49 2.71,127.14 10.82,252.25 24.35,375.34 -6.76,87.92 -31.12,126.48 -73.04,115.65 -25.69,8.11 -101.44,-30.43 -227.24,-115.65 -14.88,116.33 -28.4,236.71 -40.57,361.16 2.7,116.32 -37.87,194.1 -121.73,233.32 -45.99,2.71 -117.34,-5.4 -214.06,-24.34 -96.7,-18.94 -186.99,-27.74 -270.86,-26.39 -97.39,13.53 -174.48,21.99 -231.3,25.37 -56.79,3.39 -131.86,-7.78 -225.2,-33.48 -87.92,52.75 -202.2,68.3 -342.88,46.67 -139.31,28.4 -204.92,16.9 -196.81,-34.5 -1.35,-87.92 77.78,-131.88 237.39,-131.88 58.16,29.76 110.92,35.85 158.25,18.27 47.34,-17.59 97.39,-35.16 150.14,-52.75 64.92,-4.06 153.52,8.11 265.79,36.53 60.87,-124.44 98.74,-320.57 113.63,-588.39 37.87,-316.52 45.3,-559.64 22.31,-729.39 -22.99,-169.76 -48.7,-286.41 -77.09,-349.99 -22.99,-67.62 -100.77,-195.44 -233.32,-383.45 -259.71,-380.08 -323.29,-762.87 -190.72,-1148.37l0 0 752.73 0c41.93,169.07 75.07,356.41 99.41,562 228.59,105.51 505.2,378.73 829.82,819.68l0 0 783.15 1156.47c277.3,305.69 396.32,470.03 357.1,493.03 -16.24,13.53 -162.32,-103.46 -438.25,-351 359.79,355.74 505.87,555.93 438.25,600.57 -83.86,60.87 -180.57,93.32 -290.15,97.38 -114.96,5.4 -244.14,-21.65 -387.51,-81.16 -41.93,-16.23 -146.08,-161.64 -312.46,-436.21zm-395.62 -537.67c58.16,-25.7 207.61,143.37 448.39,507.22 155.55,255.65 248.88,390.22 279.98,403.76 246.17,112.26 447.04,114.3 602.59,6.09 -27.05,-106.86 -212.37,-314.48 -555.92,-622.88 -281.35,-288.09 -547.12,-507.22 -797.37,-657.36 -607.31,-366.56 -906.92,-647.23 -898.81,-842.01 2.71,-170.42 142.7,-253.6 419.98,-249.54l0 0 26.38 50.72c-250.24,-2.7 -378.04,60.19 -383.46,188.69 -14.88,171.77 260.39,426.75 825.76,764.89 312.46,200.19 581.63,419.98 807.51,659.4 104.15,48.7 179.9,77.09 227.23,85.2l0 0 -815.61 -1207.19c-308.39,-424.72 -585.67,-695.24 -831.85,-811.56 -20.29,-201.54 -51.4,-380.76 -93.33,-537.67l0 0 -647.22 0c-123.1,339.51 -54.11,693.88 206.96,1063.15 178.53,269.17 296.89,447.7 355.05,535.62 156.9,236.71 323.95,562.68 501.14,977.93 70.33,59.52 159.61,122.42 267.81,188.69 47.34,25.7 66.96,14.88 58.84,-32.45 -33.82,-312.46 -35.17,-469.37 -4.06,-470.71zm-541.72 407.81c41.94,-117.68 52.08,-225.88 30.43,-324.63 -70.32,-200.18 -205.58,-458.53 -405.78,-775.04 70.34,271.88 77.1,599.89 20.3,984.02l355.05 115.65zm-275.92 -20.3c-48.7,177.2 -71.69,333.42 -68.99,468.68 154.2,9.48 296.9,25.03 428.1,46.67 83.86,-60.87 89.26,-292.16 16.23,-693.88 -8.11,124.43 -31.11,215.06 -68.99,271.87l-306.35 -93.34zm-373.33 -2258.16c-91.98,9.46 -143.37,-9.48 -154.19,-56.81 85.21,-91.98 167.04,-87.92 245.51,12.17 0,181.24 14.19,292.84 42.6,334.77 27.05,-37.87 41.93,-150.81 44.64,-338.82 83.86,-102.8 165.69,-104.15 245.5,-4.06 -24.35,44.64 -75.75,63.58 -154.2,56.81 -31.11,267.81 -78.45,397.67 -142.02,389.55 -58.16,13.52 -100.77,-117.68 -127.82,-393.61z"/></svg> STaTbS21D file</a><a class="dropdown-item" data-link="' + URLo + '" onclick="downloadFile(this)"><svg xmlns="http://www.w3.org/2000/svg" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd; align:right" viewBox="0 0 1460.87 1945.75" height="2em" fill="currentColor"><path style="stroke:currentColor;stroke-width:50;stroke-miterlimit:50" d="M1447.08 464.96c5.84,21.01 8.88,42.83 8.88,64.92l0 1170.39c0,133.17 -108.99,242.11 -242.11,242.11l-968.31 0c-133.73,0 -242.12,-108.43 -242.12,-242.11l-0.05 -1452.58c0,-133.73 108.38,-242.11 242.11,-242.11l686.16 0c22.38,0 44.47,3.13 65.7,9.14l0 270.5c0,98.86 80.87,179.72 179.72,179.72l270.02 0 0 0.02zm-342.63 -390.65l282.32 282.32c45.39,45.49 70.73,107.15 70.73,171.07l0 1170.38c0,133.17 -108.98,242.11 -242.11,242.11l-968.31 0c-133.73,0 -242.11,-108.43 -242.11,-242.11l-0.05 -1452.58c0,-133.73 108.38,-242.11 242.11,-242.11l686.16 0c63.96,0 125.6,25.52 171.23,70.91l0.02 0.02z"/><path class="fil1" d="M488.45 692.39c34.57,35.06 281.85,662.38 311.72,755.22 -432.82,95.82 -443.94,-518.97 -311.72,-755.22zm526 141.41c28.88,147.54 31.59,408.65 -68.06,526.34 -41.78,-58.65 -302.07,-710.5 -306.2,-776.52 224.46,-27.07 330.17,24.82 374.26,250.2l0.01 -0.02zm-397.76 -384.81c-347.4,58.56 -419.42,370.74 -384.93,688.2 36.6,336.81 269.11,513.9 610.32,449.97 339.26,-63.59 406.11,-384.79 376.29,-689.33 -34.43,-351.47 -253.4,-507.53 -601.67,-448.84l-0.01 0z"/></svg> ORAEC file</a></div></div>';
      $('#block-content').prepend(html);
    }

    // Declare URLi variable globally to be used in downloadlinks
    var URLi = 'https://raw.githubusercontent.com/STaTbS21D/Book_of_the_Dead_Sources/main/' + Spell;

    // Initial content load
    loadContent();
  //});
  
  function downloadFile(obj) {
		
		var source = obj.getAttribute('data-link');

      $.ajax({
        url: source,
        xhrFields: {
          responseType: 'blob'
        },
        success: function(data) {
          var blob = new Blob([data]);
          var tempUrl = URL.createObjectURL(blob);
          var link = document.createElement('a');
          link.href = tempUrl;
          link.download = getFileName(source);
          link.click();
        }
      });
    }
	
	function getFileName(filePath) {
                var segments = filePath.split('/');
                var index = segments.indexOf('main');

                if (index !== -1 && segments.length > index + 1) {
					return segments[index + 1] + '_' + segments[index + 2]  + '_' + segments[index + 3];
                }

                return null;
            }
			
		
</script>
<footer id="footer" class="page-footer dark"></footer>

</div>

<script>
  const sldr = document.getElementById('sldr');
  const refData = document.getElementById('ref-data');
  const originalOffsetTop = sldr.offsetTop;
  const floatingTopMargin = 16;
  const originalTopMargin = 32;

  window.addEventListener('scroll', () => {
    const scrollY = window.scrollY || window.pageYOffset;

    const targetTop = refData.offsetTop;

    const floatingPosition = scrollY + floatingTopMargin;

    if (scrollY + originalTopMargin < originalOffsetTop) {
      sldr.style.position = 'relative';
      sldr.style.top = originalTopMargin + 'px';
      sldr.classList.remove('floating', 'stopped');
      sldr.style.left = '';
      sldr.style.bottom = '';
    } else if (floatingPosition + sldr.offsetHeight >= targetTop) {
      sldr.style.position = 'absolute';
      sldr.style.top = (targetTop - sldr.offsetHeight) + 'px';
      sldr.style.left = sldr.offsetLeft + 'px';
      sldr.classList.remove('floating');
      sldr.classList.add('stopped');
    } else {
      sldr.style.position = 'fixed';
      sldr.style.top = floatingTopMargin + 'px';
      sldr.style.left = sldr.offsetLeft + 'px';
      sldr.classList.add('floating');
      sldr.classList.remove('stopped');
    }
  });
</script>

<script>
const pag = '#nunicodefile';
$(document).ready(function () {
$('#nav-bar').load('nav.html');
$('#footer').load('footer.html');
});


$(document).ready(function () {

const urlP = new URLSearchParams(window.location.search);
			const TM = urlP.get("id");
			const Sp = urlP.get("spell");
const xmlUrl = "xmldb/tm" + TM + ".xml"; 

	
      $.ajax({
        url: xmlUrl,
        dataType: "xml", 
        success: function(xmlDoc) {
		
          $(xmlDoc).find("objekt").each(function() {  
            
			var name = $(this).find("besitzer name").not("besitzer verwandt name").text(); 
			name = name.replace(/-\s/g, '-'); name = name.replace(/-\)\s/g, ')-');
			name = name.replace(/I/g, 'i͗');
			var nameTitle = $(this).find("besitzer titel").not("besitzer verwandt titel").text();
			nameTitle = nameTitle.replace(/-\s/g, '-'); nameTitle = nameTitle.replace(/-\)\s/g, ')-'); nameTitle = nameTitle.replace(/I/g, 'i͗');
			
			var father = $(this).find("besitzer verwandt[rel='Vater'] name").text(); 
			father = father.replace(/-\s/g, '-'); father = father.replace(/-\)\s/g, ')-');
			father = father.replace(/I/g, 'i͗'); 
			var fatherTitle = $(this).find("besitzer verwandt[rel='Vater'] titel").text();
			fatherTitle = fatherTitle.replace(/-\s/g, '-'); fatherTitle = fatherTitle.replace(/-\)\s/g, ')-'); fatherTitle = fatherTitle.replace(/I/g, 'i͗');
			
			var mother = $(this).find("besitzer verwandt[rel='Mutter'] name").text(); 
			mother = mother.replace(/-\s/g, '-'); mother = mother.replace(/-\)\s/g, ')-');
			mother = mother.replace(/I/g, 'i͗'); 
			var motherTitle = $(this).find("besitzer verwandt[rel='Mutter'] titel").text();motherTitle = motherTitle.replace(/-\s/g, '-'); motherTitle = motherTitle.replace(/-\)\s/g, ')-'); motherTitle = motherTitle.replace(/I/g, 'i͗');
			
			var wife = $(this).find("besitzer verwandt[rel='Ehefrau'] name").text(); 
			wife = wife.replace(/-\s/g, '-'); wife = wife.replace(/-\)\s/g, ')-');
			wife = wife.replace(/I/g, 'i͗'); 
			var wifeTitle = $(this).find("besitzer verwandt[rel='Ehefrau'] titel").text();
			wifeTitle = wifeTitle.replace(/-\s/g, '-'); wifeTitle = wifeTitle.replace(/-\)\s/g, ')-'); wifeTitle = wifeTitle.replace(/I/g, 'i͗');
			
			var son = $(this).find("besitzer verwandt[rel='Sohn'] name").text(); 
			son = son.replace(/-\s/g, '-'); son = son.replace(/-\)\s/g, ')-');
			son = son.replace(/I/g, 'i͗'); 
			var sonTitle = $(this).find("besitzer verwandt[rel='Sohn'] titel").text();
			sonTitle = sonTitle.replace(/-\s/g, '-'); sonTitle = sonTitle.replace(/-\)\s/g, ')-'); sonTitle = sonTitle.replace(/I/g, 'i͗');
			
			var daughter = $(this).find("besitzer verwandt[rel='Tochter'] name").text(); 
			daughter = daughter.replace(/-\s/g, '-'); daughter = daughter.replace(/-\)\s/g, ')-');
			daughter = daughter.replace(/I/g, 'i͗'); 
			var daughterTitle = $(this).find("besitzer verwandt[rel='Tochter'] titel").text();
			daughterTitle = daughterTitle.replace(/-\s/g, '-'); daughterTitle = daughterTitle.replace(/-\)\s/g, ')-'); daughterTitle = daughterTitle.replace(/I/g, 'i͗');
			
			let spells = [];
			let currentSpellList = "";
			let lastWasLineBreak = false;

			var sequence = $(this).find('teilobjekt inhalt sprueche > *').each(function() {  
				const tagName = this.tagName;
				const trSp = {
				'A.d.O': 'Adoration of Osiris',
				'VA.d.O.': 'V Adoration of Osiris', 
				'A.d. Re-Harachte': 'Adoration of Ra-Heruakhety','VA.d. Re-Harachte': 'V Adoration of Ra-Heruakhety',
				'Verklärung': 'Transfiguration',
				'Ausserordentliches Textgut': 'Extraordinary texts',
				'Adorationsszene': 'Adoration scene','VAdorationsszene': 'V Adoration scene',
				'Sonnenlitanei': 'Sun litany',
				'Mythologische Szenen': 'Mythologic scene','Mythologische SzenenV': 'Mythologic scene V',
				'Hymnus': 'Hymn',
				'Gebet': 'Prayer',
				'TG': 'Tribunal of the dead',
				'VTG': 'V Tribunal of the dead',
				'A.d.Re-Harachte-Osiris': 'Adoration of Ra-Heruakhety-Osiris','VA.d.Re-Harachte-Osiris': 'V Adoration of Ra-Heruakhety-Osiris',
				'A.d. Re-Harachte-Atum': 'Adoration of Ra-Heruakhety-Atum','VA.d. Re-Harachte-Atum': 'V Adoration of Ra-Heruakhety-Atum',
				'A.d. Atum': 'Adoration of Atum',
				'VA.d. Atum': 'V Adoration of Atum',
				'A.d.?': 'Adoration?',
				'VA.d.?': 'V Adoration?',
				'Ritualtext': 'Ritual text',
				'Schlussvermerk': 'Closing note'//,'': '','': '',
				};

				if (tagName === 's') {
					var text = $(this).text();
					if (trSp.hasOwnProperty(text))
					{
						text = trSp[text];
					}
					if (currentSpellList !== "") {
						currentSpellList += " - "; 
					}
					currentSpellList += text;
					lastWasLineBreak = false; 
				} else if (tagName === 'l') {
					if (!lastWasLineBreak) {
						if(currentSpellList !== "") {
							spells.push(currentSpellList);
						}
						currentSpellList = "LC";
						lastWasLineBreak = true;
					}
				}
			});

			if (currentSpellList !== "") {
				spells.push(currentSpellList);
			}

			let joinedSpells = spells.join(' - ');
			joinedSpells = joinedSpells.replace(/LC -/g, '///'); 
			joinedSpells = joinedSpells.replace(/ - LC/g, ' - /// - '); 
			joinedSpells = joinedSpells.trim();
			if (joinedSpells.endsWith('-')) {
				joinedSpells = joinedSpells.slice(0, joinedSpells.length - 1).trim();
			}
			if (joinedSpells.endsWith('- ///')) {
				joinedSpells = joinedSpells.slice(0, joinedSpells.length - 5).trim();
				joinedSpells += ' ///';
			}

			sequence = joinedSpells;
			  
			  const spellRegex = new RegExp(`(?<![0-9])(${Sp}[A-E]*)(?![0-9])`, 'g');

				// Highlight the matched spells
				var highlightedSequence = sequence.replace(spellRegex, function(match) {
					const trimmedMatch = match.replace(/[A-Z]/g, '').trim();
					// Create a link for the matched spell
					return `<a class="btn-light" href="spells.html#sp${trimmedMatch.replace('V', '')}"><span style="color:#69b0e5;font-size:1.2em"><strong>${match}</strong></span></a>`;
				});

			var ftext = '';
			if(name != '') ftext = `<i class="statbs21d icon-Owner icon"></i><!--i class='fa fa-user icon'></i--> Owner (N): ${name.toLowerCase()}`;
			if(nameTitle != '') ftext += `  Titles: ${nameTitle.toLowerCase()}`;
			ftext += '<div style="padding-left:20px">'; if(wife != '' || father != '' || mother != '' || son != '' || daughter != '') {ftext += '<i class="statbs21d icon-Family icon"></i><!--i class="fa fa-group icon"></i--> Family: '; }
			if(wife != '') ftext += `<br> <i class="statbs21d icon-Female icon"></i> Wife (W): ${wife.toLowerCase()}`; 
			if(wifeTitle != '') ftext += `  Titles: ${wifeTitle.toLowerCase()}`;
			if(father != '') ftext += `<br> <i class="statbs21d icon-Male icon"></i> Father (F): ${father.toLowerCase()}`;
			if(fatherTitle != '') ftext += `  Titles: ${fatherTitle.toLowerCase()}`;
			if(mother != '') ftext += `<br> <i class="statbs21d icon-Female icon"></i> Mother (M): ${mother.toLowerCase()}`;
			if(motherTitle != '') ftext += `  Titles: ${motherTitle.toLowerCase()}`;
			if(son != '') ftext += `<br> <i class="statbs21d icon-Male icon"></i> Son (S): ${son.toLowerCase()}`;
			if(sonTitle != '') ftext += `  Titles: ${sonTitle.toLowerCase()}`;
			if(daughter != '') ftext += `<br> <i class="statbs21d icon-Female icon"></i> Daughter (D): ${daughter.toLowerCase()}`;
			if(daughterTitle != '') ftext += `  Titles: ${daughterTitle.toLowerCase()}`;
			ftext += '</div>';
            const $paragraph = $("<div id='TMinfo'>"); //p class='block-content'
            $paragraph.html(`<h4 class='unicode'><em>Totenbuch Projekt</em> Info for TM ${TM}</h4> ${ftext} <i class='statbs21d icon-Sequence icon'></i><!--i class='fa fa-list icon'></i--> Spell Sequence:  ${highlightedSequence} `);
            $("#TbPContent").append($paragraph); 			
			});
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.error("Error loading XML:", textStatus, errorThrown);
          // $("#markdownContent").append('<div align="center"><p class="text-bg-danger small" style="width:60%;border-radius: 18px;text-align: center">Error loading XML data from Totenbuch-Projekt database.</p></div>'); // Display error message
        }
      });
	  
	  if (TM != '') {
				$("#TbPContent").append('<h4 class="unicode">References</h4><div id="ref-data"><div align="center"><img src="assets/img/loading.gif" /></div></div>');
				$('#ref-data').load('https://mdc2unicode.x10.bz/zot.php?p=ref&tag=TM+' + encodeURIComponent(TM));
        } 
	  
});

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.js"></script><script src="assets/bootstrap/js/bootstrap-dropdown.js"></script><script src="assets/js/script.min.js"></script>
</body></html>